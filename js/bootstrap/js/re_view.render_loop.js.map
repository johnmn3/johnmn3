{"version":3,"file":"re_view.render_loop.js","sources":["re_view/render_loop.cljs"],"mappings":"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","names":["cljs.core/deref","fns","re-view.render-loop/to-run","frame-ms","re-view.render-loop/force-update-caught","c","re-view.render-loop/last-fps-time","js/re-view","js/re-view.render-loop","js/re-view.render-loop.last-fps-time","components","re-view.render-loop/to-render","re-view.render-loop/flush!","js/window","re-view.render-loop/count-fps?","cljs.core/mod","re-view.render-loop/frame-count","cljs.core/empty?","cljs.core/vreset!","js/re-view.render-loop.to-render","cljs.core/volatile!","re-view.render-loop/render-loop","cb","result","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","f","args","js/Error","e","cljs.core/-vreset!","cljs.core/-deref","cljs.core.disj.cljs$core$IFn$_invoke$arity$2","this","js/re-view.render-loop.*immediate-state-update*","re-view.render-loop/*immediate-state-update*","re-view.render-loop/request-render","js/re-view.render-loop._raf-polyfill","re-view.render-loop/_raf-polyfill","re-view.render-loop/schedule!","temp__5455__auto__","catch-fn","cljs.core.conj.cljs$core$IFn$_invoke$arity$2","enable?","js/console","seq__15508","cljs.core/seq","chunk__15509","count__15510","i__15511","temp__5457__auto__","cljs.core/chunked-seq?","c__4351__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","cljs.core/first","cljs.core/next","js/re-view.render-loop.count-fps?","js/re-view.render-loop.to-run","re-view.render-loop/force-update!","js/setTimeout","cljs.core/not","or__3949__auto__","re-view.render-loop/count-fps!","js/re-view.render-loop.frame-count","js/requestAnimationFrame","re-view.render-loop/apply-sync!","e15499","re-view.render-loop/frame-rate","seq__15516","chunk__15517","count__15518","i__15519","js/re-view.render-loop.frame-rate","re-view.render-loop/force-update"],"sourcesContent":["(ns re-view.render-loop\n  (:require [goog.object :as gobj]))\n\n(set! *warn-on-infer* true)\n(defonce ^:dynamic *immediate-state-update* false)\n\n(defonce ^:private count-fps? false)\n(defonce ^:private last-fps-time 1)\n(defonce frame-rate 0)\n(defonce frame-count 0)\n\n(defn count-fps!\n  [enable?]\n  (set! count-fps? enable?))\n\n(defonce _raf-polyfill\n         (when (js* \"typeof window !== 'undefined'\")\n           (if-not (.-requestAnimationFrame js/window)\n             (set! (.-requestAnimationFrame js/window)\n                   (or\n                     (.-webkitRequestAnimationFrame js/window)\n                     (.-mozRequestAnimationFrame js/window)\n                     (.-oRequestAnimationFrame js/window)\n                     (.-msRequestAnimationFrame js/window)\n                     (fn [cb]\n                       (js/setTimeout cb (/ 1000 60))))))))\n\n(defonce to-render (volatile! #{}))\n(defonce to-run (volatile! []))\n\n(declare request-render)\n\n(defn schedule! [f]\n  (vswap! to-run conj f)\n  (request-render))\n\n(defn force-update-caught [this]\n  (when-not (true? (aget this \"unmounted\"))\n    (try (.forceUpdate this)\n         (catch js/Error e\n           (if-let [catch-fn (aget this \"catch\")]\n             (catch-fn e)\n             (do (.debug js/console \"No :catch method in component: \" this)\n                 (.error js/console e)))))))\n\n(defn force-update! [^js/React.Component this]\n  (vswap! to-render disj this)\n  (force-update-caught this))\n\n(defn force-update [this]\n  (if (true? *immediate-state-update*)\n    (force-update! this)\n    (do\n      (vswap! to-render conj this)\n      (request-render))))\n\n(defn flush!\n  []\n  (when-not ^boolean (empty? @to-render)\n    (let [components @to-render]\n      (vreset! to-render #{})\n      (doseq [c components]\n        (force-update-caught c))))\n\n  (when-not ^boolean (empty? @to-run)\n    (let [fns @to-run]\n      (vreset! to-run [])\n      (doseq [f fns] (f)))))\n\n(defn render-loop\n  [frame-ms]\n  (set! frame-count (inc frame-count))\n  (when ^boolean (and (true? count-fps?) (identical? 0 (mod frame-count 29)))\n    (set! frame-rate (* 1000 (/ 30 (- frame-ms last-fps-time))))\n    (set! last-fps-time frame-ms))\n  (flush!))\n\n(defn request-render []\n  (js/requestAnimationFrame render-loop))\n\n\n(defn apply-sync!\n  \"Wraps function `f` to flush the render loop before returning.\"\n  [f]\n  (fn [& args]\n    (let [result (apply f args)]\n      (flush!)\n      result)))"]}