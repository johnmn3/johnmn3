{"version":3,"file":"cljs.analyzer.api.js","sources":["cljs/analyzer/api.cljc"],"mappings":"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","names":["cljs.core/deref","cljs.core.get.cljs$core$IFn$_invoke$arity$2","state","cljs.analyzer.api.ns_publics.cljs$core$IFn$_invoke$arity$2","cljs.env/*compiler*","ns","cljs.core/Symbol","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$variadic","cljs.core/update-in","cljs.core/dissoc","var_args","G__20975","cljs.analyzer.api/all-ns","js/Error","G__20941","cljs.analyzer.api/get-js-index","cljs.analyzer.api.ns_interns.cljs$core$IFn$_invoke$arity$2","sym","cljs.analyzer.resolve_var.cljs$core$IFn$_invoke$arity$3","env","G__21049","cljs.analyzer.api/remove-ns","cljs.core.remove.cljs$core$IFn$_invoke$arity$2","p__21031","vec__21032","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","k","v","G__20927","cljs.analyzer.api/get-options","G__21028","cljs.analyzer.api/ns-publics","cljs.core.into.cljs$core$IFn$_invoke$arity$2","cljs.analyzer.api.get_options.cljs$core$IFn$_invoke$arity$1","cljs.analyzer/empty-env","cljs.env.default_compiler_env.cljs$core$IFn$_invoke$arity$0","cljs.core.get_in.cljs$core$IFn$_invoke$arity$2","cljs.analyzer.api/resolve","cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic","G__21044","cljs.analyzer.api/ns-resolve","cljs.analyzer/confirm-var-exists-throw","G__21000","cljs.analyzer.api/find-ns","e","warning-type","extra","cljs.analyzer.api.find_ns.cljs$core$IFn$_invoke$arity$2","e20962","cljs.analyzer/resolve-macro-var","cljs.analyzer.api/default-warning-handler","cljs.analyzer.api.all_ns.cljs$core$IFn$_invoke$arity$1","cljs.analyzer.api/empty-state","cljs.analyzer/*cljs-warnings*","G__21025","cljs.analyzer.api/ns-interns","cljs.core/keys","cljs.analyzer.api/empty-env","cljs.analyzer.api.remove_ns.cljs$core$IFn$_invoke$arity$2","cljs.analyzer/default-warning-handler","cljs.core/map?","cljs.analyzer.api/warning-enabled?","cljs.analyzer.api.ns_resolve.cljs$core$IFn$_invoke$arity$3"],"sourcesContent":[";   Copyright (c) Rich Hickey. All rights reserved.\n;   The use and distribution terms for this software are covered by the\n;   Eclipse Public License 1.0 (http://opensource.org/licenses/eclipse-1.0.php)\n;   which can be found in the file epl-v10.html at the root of this distribution.\n;   By using this software in any fashion, you are agreeing to be bound by\n;   the terms of this license.\n;   You must not remove this notice, or any other, from this software.\n\n(ns cljs.analyzer.api\n  \"This is intended to be a stable api for those who need programmatic access\n  to the analyzer.\"\n  (:refer-clojure :exclude [all-ns ns-interns ns-resolve resolve find-ns\n                            ns-publics remove-ns])\n  (:require [cljs.env :as env]\n            [cljs.analyzer :as ana]))\n\n;; =============================================================================\n;; Useful Utilities\n\n(defn empty-state\n  \"Creates an empty compilation state Atom<Map>.\"\n  []\n  (env/default-compiler-env))\n\n(defmacro with-state\n  \"Run the body with the given compilation state Atom<Map>.\"\n  [state body]\n  `(env/with-compiler-env ~state\n     ~@body))\n\n(defn empty-env\n  \"Creates an empty analysis environment.\"\n  []\n  (ana/empty-env))\n\n(defmacro no-warn\n  \"Disable analyzer warnings for any analysis executed in body.\"\n  [& body]\n  (let [no-warnings (zipmap (keys ana/*cljs-warnings*) (repeat false))]\n    `(binding [ana/*cljs-warnings* ~no-warnings]\n       ~@body)))\n\n(defn warning-enabled?\n  \"Test if the given warning-type is enabled.\"\n  [warning-type]\n  (ana/*cljs-warnings* warning-type))\n\n(defn default-warning-handler\n  \"The default warning handler.\n\n   Outputs the warning messages to *err*.\"\n  [warning-type env extra]\n  (ana/default-warning-handler warning-type env extra))\n\n(defn get-options\n  \"Return the compiler options from compiler state.\"\n  ([] (get-options env/*compiler*))\n  ([state]\n   (get @state :options)))\n\n(defn get-js-index\n  \"Return the currently computed Google Closure js dependency index from the\n  compiler state.\"\n  ([] (get-options env/*compiler*))\n  ([state]\n   (get @state :js-dependency-index)))\n\n#?(:clj\n   (defn analyze\n     \"Given an environment, a map containing {:locals (mapping of names to bindings), :context\n     (one of :statement, :expr, :return), :ns (a symbol naming the\n     compilation ns)}, and form, returns an expression object (a map\n     containing at least :form, :op and :env keys). If expr has any (immediately)\n     nested exprs, must have :children [exprs...] entry. This will\n     facilitate code walking without knowing the details of the op set.\"\n     ([env form] (analyze env form nil))\n     ([env form name] (analyze env form name nil))\n     ([env form name opts]\n      (analyze\n        (if-not (nil? env/*compiler*)\n          env/*compiler*\n          (env/default-compiler-env opts))\n        env form name opts))\n     ([state env form name opts]\n      (env/with-compiler-env state\n        (binding [ana/*cljs-warning-handlers* (:warning-handlers opts ana/*cljs-warning-handlers*)]\n          (ana/analyze env form name opts))))))\n\n#?(:clj\n   (defn forms-seq\n     \"Seq of Clojure/ClojureScript forms from rdr, a java.io.Reader. Optionally\n     accepts a filename argument which will be used in any emitted errors.\"\n     ([rdr] (ana/forms-seq* rdr nil))\n     ([rdr filename] (ana/forms-seq* rdr filename))))\n\n#?(:clj\n   (defn parse-ns\n     \"Helper for parsing only the essential namespace information from a\n      ClojureScript source file and returning a cljs.closure/IJavaScript compatible\n      map _not_ a namespace AST node.\n   \n      By default does not load macros or perform any analysis of dependencies. If\n      opts parameter provided :analyze-deps and :load-macros keys their values will\n      be used for *analyze-deps* and *load-macros* bindings respectively. This\n      function does _not_ side-effect the ambient compilation environment unless\n      requested via opts where :restore is false.\"\n     ([src] (parse-ns src nil nil))\n     ([src opts] (parse-ns src nil opts))\n     ([src dest opts]\n      (parse-ns\n        (if-not (nil? env/*compiler*)\n          env/*compiler*\n          (env/default-compiler-env opts))\n        src dest opts))\n     ([state src dest opts]\n      (env/with-compiler-env state\n        (binding [ana/*cljs-warning-handlers* (:warning-handlers opts ana/*cljs-warning-handlers*)]\n          (ana/parse-ns src dest opts))))))\n#?(:clj\n   (defn analyze-file\n     \"Given a java.io.File, java.net.URL or a string identifying a resource on the\n      classpath attempt to analyze it.\n   \n      This function side-effects the ambient compilation environment\n      `cljs.env/*compiler*` to aggregate analysis information. opts argument is\n      compiler options, if :cache-analysis true will cache analysis to\n      \\\":output-dir/some/ns/foo.cljs.cache.edn\\\". This function does not return a\n      meaningful value.\"\n     ([f] (analyze-file f nil))\n     ([f opts]\n      (analyze-file\n        (if-not (nil? env/*compiler*)\n          env/*compiler*\n          (env/default-compiler-env opts))\n        f opts))\n     ([state f opts]\n      (env/with-compiler-env state\n        (binding [ana/*cljs-warning-handlers* (:warning-handlers opts ana/*cljs-warning-handlers*)]\n          (ana/analyze-file f opts))))))\n\n;; =============================================================================\n;; Main API\n\n(defn resolve\n  \"Given an analysis environment resolve a var. Analogous to\n   clojure.core/resolve\"\n  [env sym]\n  {:pre [(map? env) (symbol? sym)]}\n  (try\n    (ana/resolve-var env sym\n      (ana/confirm-var-exists-throw))\n    (catch #?(:clj Exception :cljs :default) e\n      (ana/resolve-macro-var env sym))))\n\n(defn all-ns\n  \"Return all namespaces. Analagous to clojure.core/all-ns but\n  returns symbols identifying namespaces not Namespace instances.\"\n  ([]\n   (all-ns env/*compiler*))\n  ([state]\n   (keys (get @state ::ana/namespaces))))\n\n(defn find-ns\n  \"Given a namespace return the corresponding namespace analysis map. Analagous\n  to clojure.core/find-ns.\"\n  ([sym]\n   (find-ns env/*compiler* sym))\n  ([state sym]\n   {:pre [(symbol? sym)]}\n   (get-in @state [::ana/namespaces sym])))\n\n(defn ns-interns\n  \"Given a namespace return all the var analysis maps. Analagous to\n  clojure.core/ns-interns but returns var analysis maps not vars.\"\n  ([ns]\n   (ns-interns env/*compiler* ns))\n  ([state ns]\n   {:pre [(symbol? ns)]}\n   (merge\n     (get-in @state [::ana/namespaces ns :macros])\n     (get-in @state [::ana/namespaces ns :defs]))))\n\n(defn ns-publics\n  \"Given a namespace return all the public var analysis maps. Analagous to\n  clojure.core/ns-publics but returns var analysis maps not vars.\"\n  ([ns]\n   (ns-publics env/*compiler* ns))\n  ([state ns]\n   {:pre [(symbol? ns)]}\n   (->> (merge\n          (get-in @state [::ana/namespaces ns :macros])\n          (get-in @state [::ana/namespaces ns :defs]))\n        (remove (fn [[k v]] (:private v)))\n        (into {}))))\n\n(defn ns-resolve\n  \"Given a namespace and a symbol return the corresponding var analysis map.\n  Analagous to clojure.core/ns-resolve but returns var analysis map not Var.\"\n  ([ns sym]\n   (ns-resolve env/*compiler* ns sym))\n  ([state ns sym]\n   {:pre [(symbol? ns) (symbol? sym)]}\n   (get-in @state [::ana/namespaces ns :defs sym])))\n\n(defn remove-ns\n  \"Removes the namespace named by the symbol.\"\n  ([ns]\n   (remove-ns env/*compiler* ns))\n  ([state ns]\n   {:pre [(symbol? ns)]}\n   (swap! state update-in [::ana/namespaces] dissoc ns)))\n\n(defmacro in-cljs-user\n  \"Binds cljs.analyzer/*cljs-ns* to 'cljs.user and uses the given compilation\n  environment atom and runs body.\"\n  [env & body]\n  `(binding [cljs.analyzer/*cljs-ns* 'cljs.user]\n     (cljs.env/with-compiler-env ~env\n       ~@body)))\n"]}